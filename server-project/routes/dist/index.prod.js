"use strict";var express=require("express"),router=express.Router(),_require=require("../db/db"),find=_require.find,insert=_require.insert,updateOne=_require.updateOne,remove=_require.remove;router.get("/ordeing",function(r,n){var t,s,a,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.append("Access-Control-Allow-Origin","*"),t=r.query,s=t.usercard,a=t.tel,!s||!a){e.next=22;break}if(!(o=/^(\d{17}|\d{14})[\dx]$/.test(s))){e.next=21;break}if(console.log(o),o=/^1[3-9]\d{9}$/.test(a))return console.log(o),e.next=13,regeneratorRuntime.awrap(updateOne("admit",{usercard:s},{tel:a}));e.next=18;break;case 13:u=e.sent,n.send("2"),console.log(u.result.ok),e.next=19;break;case 18:n.send("0");case 19:e.next=22;break;case 21:n.send("0");case 22:case"end":return e.stop()}})}),router.get("/order",function(r,n){var t,s,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n.append("Access-Control-Allow-Origin","*"),t=r.query,s=t.usercard,a=t.password,e.next=4,regeneratorRuntime.awrap(find("admit",{usercard:s,password:a}));case 4:o=e.sent,n.json(o);case 6:case"end":return e.stop()}})}),router.get("/uporder",function(r,n){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n.append("Access-Control-Allow-Origin","*"),t=r.query.usercard,e.next=4,regeneratorRuntime.awrap(find("admit",{usercard:t}));case 4:s=e.sent,n.json(s);case 6:case"end":return e.stop()}})}),router.get("/xiugai",function(r,n){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n.append("Access-Control-Allow-Origin","*"),t=r.query,console.log(r.query),e.next=5,regeneratorRuntime.awrap(find("admit",{usercard:t.usercard}));case 5:s=e.sent,console.log(s.length),0<s.length?updateOne("admit",{qq:t.qq},{tel:t.tel}).then(function(){n.send("2")}):n.send("0");case 8:case"end":return e.stop()}})}),router.get("/pass",function(r,n){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n.append("Access-Control-Allow-Origin","*"),t=r.query,e.next=4,regeneratorRuntime.awrap(find("admit",{password:t.oldpass,usercard:t.usercard}));case 4:s=e.sent,n.json(s);case 6:case"end":return e.stop()}})}),router.get("/chanpass",function(r,n){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.append("Access-Control-Allow-Origin","*"),!(t=r.query).usercard||!t.newpass){e.next=19;break}if(!/^(\d{17}|\d{14})[\dx]$/.test(t.usercard)){e.next=18;break}if(/^\S{6,20}$/.test(t.newpass))return e.next=11,regeneratorRuntime.awrap(updateOne("admit",{usercard:t.usercard},{password:t.newpass}));e.next=15;break;case 11:1==e.sent.result.ok&&n.send("2"),e.next=16;break;case 15:n.send("0");case 16:e.next=19;break;case 18:n.send("0");case 19:case"end":return e.stop()}})}),module.exports=router;